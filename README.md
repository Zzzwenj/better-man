# 觉醒空间 (Rewire) - 神经极客风数字疗法 (MVP)

**开发者内部日志与项目状态 (Developer Log)**

## 阶段 1-2：UI/UX 核心视觉重构 (Neuro-Geek Aesthetic)
- 废弃了初代廉价的绿色打卡界面，采用了全屏暗黑系（黑曜石/深空紫/荧光绿）交织的“神经极客风”。
- **主控舱 (Dashboard)**: 动态 3D 能量核心动画，支持显示基于启动时间戳计算的“净化小时数”和“神经阶段”。内置每日认知强化组件（MotivationalQuote）作为首屏精神注射。
- **干预舱 (AI Companion)**: 临床级对讲界面，玻璃态磨砂质感。**[架构升级]**：彻底重构底层布局逻辑，摒弃容易导致移动端穿透与遮挡的绝对定位方案，采用原生 Flexbox 弹性流。加入现代极客风“悬浮发光胶囊”输入框与沉浸式高斯模糊，并引入 `nextTick` + `scrollTop` 的精准消息流自动滚动吸底感知机制。带有付费护城河解锁拦截。
- **观测图谱 (Journey)**: 剔除常规的“打卡日历”，采用极具压迫感的热力图，直观显示基于坚持天数换算的“前额叶修复率”和“边缘系统渴求频次”。底部接入**神经重塑里程碑（1-365天）**，支持横向丝滑滚动，解锁态具有呼吸流光动效（Glow Effect），进行中目标带有 SVG 环形进度条（Progress Ring），彻底剥离了与主控舱冗余的数据，还原了临床客观呈现质感。
- **系统中心 (Profile)**: “伪装代码”与底层防御系统的 UI 占位，强烈的骇客掌控感。

## 阶段 3：科学基线评估 (Onboarding)
- 新增了第一视角渐进式量表问卷流 (`pages/onboarding/index.vue`)。
- **收集维度**: 包含用户的年龄段、多巴胺侵蚀史、最高爆发频次及核心触发场景（如深夜失眠、高压焦虑）。
- **路由守护**: 在 `App.vue` 拦截，识别新用户并强制重定向完成问卷，问卷数据将序列化储存于本地设备 (`uni.setStorageSync`)。

## 阶段 4：产生黏性的动态逻辑重构 (MVP Optimization)
- **多态物理阻断 (Panic Redline)**: 大盘的“紧急干预”不再只是倒计时。点击后全屏黑化接管，强震动预警，必须将手机放下并用鼻尖点击屏幕完成要求次数的“俯卧撑验证”才能解除红线。
- **AI 灵魂注入 (LLM Integration)**: 干预舱对接了大语言模型。通过封装 Phase 3 收集的本地生理画像作为 System Prompt 前缀，让 AI 能使用冷峻、专业的科研口吻，针对用户痛点进行毫秒级心理拉扯。
- **生理图鉴动态算法**: 观测舱的数据不再是 `Math.random`。底层会抓取用户首次设定的时间戳，利用数学公式按天数严格计算其“受体修复率”。清零的惩罚具有极强的“损失厌恶”震慑力。

### 下一步深水区计划 (TBD):
1. **[本地数据库]**: 引入成熟的云端数据库 (如 uniCloud 或自建 Node.js 服务) 替代本地 Storage，实现多端同步和登录系统。
2. **[系统级拦截]**: 调研安卓原生插件 (Accessibility Service)，探索通过无障碍服务全局监听浏览器 URL 并强制全屏阻断的可能性。
3. **[隐秘模式]**: 开发“特工开关”，点击后整个应用 UI 瞬间变成暗网字符风格或伪装成普通计算机。

## 阶段 5：UI 布局优化与赛博化重构 (Scroll & Milestone Overhaul)
- **局部引擎优化**: 修复了云端函数返回缺失 `_id` 导致 Vue 列表渲染乱序及只显示单条消息的严重 Bug，加入了渐变发光式头像 UI 增强战区社交真实感。
- **全局视口约束 (Viewport Lock)**: 根除了由于 `100vh` 结合 `padding` 及未设置 `box-sizing` 造成的 iPhone/Android 容器溢出导致的多余滚动条。将主控舱 (Dashboard)、系统中心 (Profile) 和干预舱 (AI Companion) 从底层全部替换为 `height: 100%` 接管，实现了原生 App 级别的丝滑固定底座。
- **觉醒图谱系统 (Journey Redesign)**: 
  - 彻底解构了 UniApp `<scroll-view>` 在 Flex 下的子元素压缩 Bug，重写底板为原生 `inline-block` 架构，实现极其顺畅的横向徽章滚动。
  - 移除了廉价的 Emoji，重绘赛博朋克几何图腾的专属徽章体系（如 ❂, ⚡, ⎊, ☬）。
  - 追加了更平滑的阶段过渡（120天 虚空行走，150天 潜意识净化，270天 绝对中立）。
- **高光裂变体系 (Virality)**: 新增独立的 `<MilestoneShareCard>` 组件，支持点击已解锁徽章弹出全屏黑化流光覆盖层，携带“BETTER MAN”水印和用户专属 UID 的截图海报，赋予用户沉浸式的成就感以利于自发传播。

## 阶段 6：AI 护盾深度赋能与商业级重构 (AI Shield & DeepSeek Integration)
- **破除调用枷锁**: 彻底去除了前端原有的“今日免费额度 1/1”限制及次级页面的 9.9 元解锁付费墙 UI，向用户开放无限算力连接体验。
- **底层架构隐匿化 (Security Proxy)**: 废弃了高风险的前端直连大模型逻辑，新增 `ai-shield` 专属 uniCloud 云函数。API Key 移步云端，实现安全代理，杜绝黑客抓包与额度盗刷。
- **Token 节流机制 (Context Truncation)**: 在业务层实现了历史消息滑动窗口算法。严格截断并仅传递 System Prompt 及最近 6 条用户往日对话流，在提供上下文记忆的同时大幅压降 API 账单成本。
- **大模型强力引擎驱动**: 彻底告别关键词硬编码回复，全面对接市售顶流 **DeepSeek (V3/R1 兼容接口)**。放宽上下文返回 token，确保咨询话术详尽连贯。
- **双模动态神经潜意识接管 (Adaptive Persona)**: 定制化重构了 Prompt 核心逻辑。系统将毫秒级甄别用户的输入意图：
  - **[失控深渊模式]**：检测到“想看、忍不住、破戒”，瞬间化身铁腕军事教官，无差别切断借口，要求立刻执行诸如冷水洗脸等物理阻断。
  - **[创伤抱持模式]**：检测到“痛苦、内疚、坚持很久”，自动降维转型为认知行为治疗（CBT）专家。给予用户受体恢复期的科学情绪抚慰与渐进式行动指南。

## 阶段 7：配置重构与交互闭环 (Profile & Onboarding Refactor)
- **初始准入闭环重制 (Entry Override)**: 修改了整体的默认路由。用户首次进入并不会看到莫名其妙的“计算器”，而是直面极具黑客风格的 `Login` 身份核验。如果探测到本地不存在 `neuro_baseline` 基线数据，严禁进入 `Dashboard`，强制转入深度测评体系。
- **临床级调研深化 (Advanced Baseline Assessment)**: 在 `Onboarding` 量表中废除了前后端割裂感的“应用伪装选项”，彻底回归到纯粹的生理/心理画像构建。
  - **交互体验 (Sub-UI Polish)**: 引入了 `popIn` 与 `glitch` 故障动效，对所有被选中的极客卡片增加了翠绿色光效聚焦，确保特工仪表的代入氛围拉满。为防止误触，增加了强震动反馈的“上一步”回退后悔药机制。
- **系统中心抽离与工程化 (Component-Based Profile)**: 重建了原本代码面条化的 `Profile` 主页 
  - **强内聚解耦**: 将头部卡片独立为组件 `<ProfileUserCard>`, 将底部的设置数组列表也解耦为了 `<ProfileSettingsList>`。主页面体积直降 70%，并对未开发功能挂载响应式提示防止“死按钮”。
- **档案重塑能力 (Avatar & Bios Override)**: 
  - **原生图库读取**: 头像位置不再是静态死图，点击开启原生相册选择 `chooseImage` 授权机制。
  - **个性宣言输入**: 用户能够定制化录入不超过 20 字的专属“戒断信条”，这些数据不仅会通过组件传值机制双向流转响应回主页，更将作为最新的节点合并不覆盖地覆盖回本地 Storage (`neuro_baseline`) 中永久提亮。
- **越权遮挡层防刺穿 (Native Stacking Fix)**: 针对小程序平台普遍存在的原生 `switch` 按钮击穿弹窗的问题，我们放弃了“吃力不讨好”的遮罩隐藏法。通过调整 DOM 兄弟节点结构使其脱离父类的 Opacity 层叠上下文控制，以瞬发式的 0 过渡动画呈现弹窗，彻底且干净地避免了原生开关穿透界面的灾难 Bug，保障了严肃医疗界面的视觉严谨度。

## 阶段 8：全链路真实身份重塑 (Authentic Identity)
- **摒弃第三方授权**: 彻底移除了原有的微信与 QQ 快捷登录入口，以“原生手机号/邮箱 + 密码”的双轨制，重拾应用的独立掌控感与用户隐私隔离。
- **动态防刷表单 (Dynamic Login Form)**: 
  - 前端输入框植入智能防呆机制，输入纯数字时前置 `+86` 标识，输入字母时自动隐藏。
  - 点击“获取安全指令”时，系统会在毫秒级进行正则判别（`validateAccount`），智能路由至短信分发或邮件派发云函数，实现交互无感分流。
- **真实基盘搭建 (uni-id-cf Integration)**: 彻底停用静态的假数据验证。
  - **[邮件安全链路]**: 引入了 `nodemailer` 库，成功对接 QQ 邮箱 SMTP 服务作为官方验证中枢，支持富文本指令直接投递至用户私域。
  - **[短信宝基站接入]**: 剥离了高门槛的阿里云/腾讯云通信，转而使用 `uniCloud.httpclient` 底层模块轻量级挂载 [短信宝] 的下发接口。
  - **[MD5 密码加固]**: 针对短信宝接口引入了 `crypto-js`，将明文密码转化为标准的 LowerCase MD5 密文进行云端握手，彻底避免了由于特殊字符（例如感叹号）造成的 URL 编码截断与报错（Error 30）。
  - **[闭环云原生鉴权]**: 云函数层支持多维度校验，用户注册时会将发放的 6 位安全指令与时间戳落盘于云数据库 (`uni-verify-codes`)。密码统一进行不可逆的 SHA256 加盐混淆 (`hashPassword`) 存储于 `uni-id-users` 库，并下发 Token 保持与旧版测试体系的向下兼容。

## 阶段 9：神经元徽章系统重构与赛博级 UI 强化 (Badge System Overhaul)
- **独立组件抽离 (Component Extraction)**: 彻底解耦了 `journey` 页面中臃肿的内联徽章渲染代码，抽象出高内聚的 `NeuroBadge.vue` 组件，使主观测页面的逻辑大幅度精简。
- **三态视觉引擎 (Tri-State Visual Engine)**: 废弃了廉价的 Unicode 字符与静态边框，为徽章引入了严谨的三段式状态机：
  - **沉睡态 (Locked)**: 暗黑生铁质感加 100% 灰度蒙版，呈现未激活的压抑感。
  - **充能态 (Progress)**: 引入 SVG 级物理环形进度条 (`stroke-dashoffset` 算法精确还原进度)，赋予徽章心跳般的微弱光环呼吸动效。
  - **爆发态 (Unlocked)**: 强烈的微孔玻璃折射高光、深空蓝紫发光背景与赛博弥散光圈 (Glow Effect) 层叠发力，并附带平滑的缓动悬浮 (Float Animation) 为用户提供强烈的心理奖励。
- **自定义导航拦截 (Bottom Navigation Overlay)**: 在所有核心舱室（Dashboard, Journey, Companion, Profile）全面普及了悬浮态 `CustomTabBar`，根除了原生 TabBar 的死板样式，确保了整端 "Rewire" 的沉浸式心流体感。

## 阶段 10：全局神经漫游 (Dynamic Theme Customization)
- **色彩空间基建 (Store Rewire)**: 使用 Pinia 对全局色彩状态进行了接管。移除了早期写死的 `#00e5ff` (赛博青)，取而代之的是 `var(--theme-primary)` 等一系列核心 CSS Variables 的动态注入。
- **自定义色彩矩阵 (ThemeActionSheet)**: 在个人主页 (Profile) 新增“视觉干预协议”覆盖层。为防止用户乱选导致风格崩塌，我们取消了原生的 HEX 取色器，提供了经过临床颜色心理学挑选的 **36 色专属矩阵**：
  - **赛博觉醒 (高饱和霓虹)**: 激发高能干预态。
  - **深空潜行 (暗黑冷调)**: 内敛克制的极客感。
  - **神经舒缓 (莫兰迪护眼)**: 对冲睡前视觉疲劳的低饱和度软色调。
- **引擎级光影推演算法**: 基于用户在矩阵中选择的单色，主题引擎会瞬间在内存中自动计算并衍生出该色的 **同系渐近色 (Grad-Start/End) / 0.05 高光底色 (BG-Highlight) / 0.4 大面积全息投影色 (Shadow-Primary)** 以供全局复用。
- **UI 裂变消除**: 将遗留在“每日认知”、“勋章重塑系统”、“全局导航”及各大按钮中的所有硬编码蓝调光斑扫清，实现了从按钮态到毛玻璃渲染的真正的 100% 同步流光变轨。
## 阶段 11：档案云端持久化与静默免登体系 (Cloud Sync & Auto-Login)
- **档案矩阵上云 (Profile Synchronization)**: 
  - 彻底抛弃了原生相册，为系统中心 (`Profile`) 接入了 60 个内置的高级极简机器人/黑客头图 (`DiceBear bottts`) 引擎，强化神经特工沉浸感。
  - 用户的名号 (Nickname)、图标与个性宣言不仅存在本地，更改后将即时通过 `user-center` 云函数进行远端上链覆盖。
- **系统级防篡改机制 (Anti-Tampering & Security)**:
  - **[30天冷却规则]**：服务端强制阻断极其频繁的代号修改，凡变更 `nickname` 均会被执行严格的时间戳差值比对，未满 30 天将触发拦截防线并告知冷却倒数。
  - **[违禁词正则封锁]**：在云端植入了数十组敏感/涉政/黑灰产违禁词表，拦截不当的个性签名与名称。
- **全局静默免登分发 (Global Router Guard)**:
  - 废除了每次强行重启后必须输入凭证的繁复流程。在应用 `App.vue` 生命周期 (`onLaunch`) 植入底层路由守卫 `checkAutoLogin`。
  - 毫秒级探测本地 `token` 有效期及 `neuro_baseline` 问卷基线。若凭证双满，则执行无缝时空穿梭 (`switchTab`) 闪击到主控舱。
- **基坑探测持久化 (Onboarding Payload)**:
  - 为了杜绝本地清缓存导致的失忆，问卷基线流程不仅进行终端封存，还在最后点击“生成协议”的一刹那触发 `syncBaseline` 云端同步。即使换设备登陆，也能完美恢复特工画像。

## 阶段 12：UI 吸引力与 UX 交互深度优化 (UI/UX Motion Overhaul)
- **主控空间重构 (Dashboard Refactor)**: 
  - 核心能量环 (`EnergyCore`) 抽离，升级多维 CSS3 发光旋转能量环、数据悬浮层特效与呼吸晕影。
  - 数据面板 (`DataCards`) 抽离，引入内发光与悬停微交互。
  - 阻断覆盖层 (`PanicOverlay`) 抽离，增强红屏急促呼吸背景特效、赛博风警示外围圈、以及故障文字颤动（Glitch）带来的压迫质感。
- **悬浮球物理引擎重建 (AI Fab Native Physics)**: 彻底丢弃特定终端下存在穿透 Bug 的 `<movable-area>` 组件嵌套，直接底层使用纯原生 `@touchstart` 与 `@touchmove` 计算进行拖拽接管，彻底修复拖拽死锁、无法移动等跨端兼容痛点。
- **战区弹簧进场 (War-Room Spring Pop)**: 为战区聊天气泡植入 `msg-pop` 的递进式弹跳位移动画，消除单调僵硬的 DOM 渲染感。
- **徽章沉睡蒙版 (Locked Badge Blur)**: 为 Journey 模块中未解锁的徽章强制启用 100% 灰度、` blur` 滤镜加体积缩小压制，以形成解禁时的极强视觉反差冲击。

## 阶段 13：云端知识库深度重构与沉浸展示优化 (Cloud Knowledge Base & UI Polish)
- **真·独立文本注入 (Authentic AI Content Generation)**: 
  - 彻底抛弃了早期使用 `for` 循环拼接重复文章模板导致“千篇一律”的劣质感。
  - 在 `initLibraryData` 云函数中，注入了 **20 篇完全独立手写的高质量神经科学/成瘾机制深度干货长文**。每篇文章都配备了专属的《核心思想推演》与《实验佐证指南》，确保用户每一次点开都有获得感。
  - 在视频库中，接入了多条稳定的高清公网测试视频（如 Big Buck Bunny），确保视频流能够实打实地内嵌播放而不是死链。
- **全局并发抗压与云限流防御 (Resource Exhausted Shield)**:
  - 针对 uniCloud 免费版严苛的读写限流，大幅优化数据库初始化逻辑。取消了极度消耗读写资源的“全表分批循环删除”方案。
  - 数据录入改为 **单次大包写入 (bulk_insert)**，最大限度降低并发 API 消耗。
  - 增加了友好的防刷异常拦截机制 (`try-catch`)，在云端冷却期以人性化的 UI 提示引导极客静默等待，杜绝红字报错。
- **沉浸式视口与安全区修复 (Notch & Safe Area Fix)**: 
  - 针对图文库 (`pages/article/index.vue`) 与详情页 (`pages/article_detail/index.vue`)，修复了顶部标题栏被刘海屏/状态栏无情遮挡的恶性排版 Bug。全面普及 `pt-header`（通过计算 `var(--status-bar-height) + 固定高度`），确保沉浸式暗黑风格下内容区依然绝对安全清晰。
- **云端表单基建一键同步 (Schema Auto-Sync)**: 规范化了 `better-articles` 集合表，用户可通过 HBuilderX 端直接执行 `better-articles.schema.json` 上传，达成极其丝滑的无代码一键删库重生闭环。
